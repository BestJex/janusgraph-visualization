<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="index.css">
    <style>

        .text {
            font-size: 14px;
        }

        .bg-purple-dark {
            background: #99a9bf;
        }

        .bg-purple {
            background: #d3dce6;
        }

        .bg-purple-light {
            background: #e5e9f2;
        }

        .grid-content {
            border-radius: 4px;
        }

        .el-card__body {
            padding: 10px;
        }
    </style>
</head>
<body>
<div id="app">
    <div>
        <el-card class="box-card">
            <div class="text item" style="padding-bottom: 5px;">
                <el-input type="textarea" v-model="gremlin" rows="5" resize="none"></el-input>
            </div>
            <el-row>
                <div>
                    <el-col :span="4">
                        <div>
                            <el-input v-model="host" size="small">
                                <template slot="prepend">地址</template>
                            </el-input>
                        </div>
                    </el-col>
                    <el-col :span="4">
                        <div>
                            <el-input v-model="port" size="small">
                                <template slot="prepend">端口</template>
                            </el-input>
                        </div>
                    </el-col>
                    <el-col :span="1" :offset="14">
                        <div>
                            <el-button size="small" style="margin-top: 5px;" v-on:click="query" type="primary">执行</el-button>
                        </div>
                    </el-col>
                </div>
            </el-row>
        </el-card>
    </div>
    <div style="padding-top: 5px;">
        <el-col>
            <el-col :span="6">
                <el-card class="box-card" id="result">
                    <div slot="header" class="clearfix">
                        <span>查询结果</span>
                    </div>
                    <div class="text item" id="result-data">
                    </div>
                </el-card>
            </el-col>
            <el-col :span="18" style="padding-left: 5px;">
                <el-card id="graph" class="box-card">

                </el-card>
            </el-col>
        </el-col>
    </div>
</div>
</body>
<!-- import Vue before Element -->
<script src="vue.js"></script>
<!-- import JavaScript -->
<script src="index.js"></script>
<script src="../jquery-3.4.1.min.js"></script>
<script src="../echarts.min.js"></script>
<script>
    function getContentSize() {
        var wh = document.documentElement.clientHeight;
        var eh = 277;
        ch = (wh - eh) + "px";
        document.getElementById("result").style.minHeight = ch;
        var c = 277;
        gh = (wh - c) + "px";
        document.getElementById("graph").style.minHeight = gh;
    }

    window.onload = getContentSize;

    var vue = new Vue({
        el: '#app',
        data: {
            host: "localhost",
            port: 8182,
            gremlin: "",
            tmp: ""
        },
        methods: {
            query: function (p) {
                $.ajax({
                    type: "GET",
                    contentType: "application/json;charset=UTF-8",
                    //请求地址
                    url: "/query",
                    //数据，json字符串
                    data: {host: this.$data.host, port: this.$data.port, gremlin: this.$data.gremlin},
                    dataType: "json",
                    //请求成功
                    success: function (result) {
                        console.log(result);
                        $("#result-data").html(result.result.replace(/\n/g, "<br/>"));
                        var myChart = echarts.init(document.getElementById('graph'));
                        option = {
                            title: {
                                text: ''
                            },
                            tooltip: {
                                formatter: function (param) {
                                    return "id:" + param.data.id + "<br/>" + "label:" + param.data.label;
                                }
                            },
                            animationDurationUpdate: 1500,
                            animationEasingUpdate: 'quinticInOut',
                            label: {
                                normal: {
                                    show: true,
                                    textStyle: {
                                        fontSize: 12
                                    },
                                }
                            },
                            series: [
                                {
                                    type: 'graph',
                                    layout: 'force',
                                    symbol: 'circle',
                                    symbolSize: 45,
                                    edgeSymbolSize: [4, 10],
                                    focusNodeAdjacency: true,
                                    edgeSymbol: ['circle', 'arrow'],
                                    categories: [{
                                        itemStyle: {
                                            normal: {
                                                color: "#009800",
                                            }
                                        }
                                    }],
                                    roam: true,
                                    label: {
                                        normal: {
                                            show: true,
                                            textStyle: {
                                                fontSize: 10
                                            },
                                            formatter: function (param) {
                                                return param.data.label;
                                            }
                                        }
                                    },
                                    force: {
                                        repulsion: 1000
                                    },
                                    edgeLabel: {
                                        normal: {
                                            show: true,
                                            textStyle: {
                                                fontSize: 10
                                            },
                                            formatter: function (param) {
                                                return param.data.label;
                                            }
                                        }
                                    },
                                    data: result.vertices,
                                    links: result.edges,
                                    lineStyle: {
                                        normal: {
                                            type: 'solid',
                                            opacity: 1,
                                            width: 2,
                                            curveness: 0
                                        }
                                    }
                                }
                            ]
                        };
                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);

                        myChart.on('click', function (params) {
                            // vue.Message.closeAll();
                            var title = "id:" + params.data.id + ",label:" + params.data.label;
                            console.log(params);
                            var c = "";
                            var props = params.data.properties;
                            for (var i = 0; i < props.length; i++) {
                                c += props[i].key + ":" + props[i].value + "\n";
                            }
                            vue.$notify({
                                title: title,
                                message: c,
                                dangerouslyUseHTMLString: true,
                                duration: 500000
                            });
                            console.log(vue.$notify);


                        });

                    },
                    //请求失败，包含具体的错误信息
                    error: function (e) {
                        console.log(e.status);
                        console.log(e.responseText);
                    }
                });
            }
        }
    })
</script>
</html>
